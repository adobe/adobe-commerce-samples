var q=Object.defineProperty;var o=(e,a)=>q(e,"name",{value:a,configurable:!0});var u=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports);var R=u((P,c)=>{async function w(e,a,s,r,t,n){try{let i=await t.state.get(e);if(i)return t.logger.log(`${n}_CACHE_HIT`),JSON.parse(i);if(t._inFlightRequests||(t._inFlightRequests={}),t._inFlightRequests[e])return t.logger.log(`${n}_CACHE_MISS_WAITING_FOR_INFLIGHT`),await t._inFlightRequests[e];t.logger.log(`${n}_CACHE_MISS_FETCHING_API`);let l=(async()=>{let F=await s(),g=r(F);return t.logger.log(`${n}_FETCHED_SUCCESS`),await t.state.put(e,JSON.stringify(g),{ttl:a}),g})();t._inFlightRequests[e]=l;let y=await l;return delete t._inFlightRequests[e],y}catch(i){return t.logger.error(`${n}_FETCH_ERROR`,{error:i.message}),t._inFlightRequests&&t._inFlightRequests[e]&&delete t._inFlightRequests[e],{}}}o(w,"fetchWithCache");c.exports={fetchWithCache:w}});var _=u((z,C)=>{var S="AC-Policy-Market",L="https://68f9294cdeff18f212b8d32d.mockapi.io/vatrates";C.exports={policyMarketHeader:S,ratesEndpoint:L,VAT_RATES_TTL:604800}});var T=u((B,A)=>{var{fetchWithCache:H}=R(),{VAT_RATES_TTL:O,ratesEndpoint:I}=_();async function k(e){return H("VAT_RATES",O,o(async()=>{let r=await fetch(I,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`VAT rates API request failed: ${r.status} ${r.statusText}`);return await r.json()},"fetchFn"),o(r=>{let t={};return Array.isArray(r)&&r.forEach(n=>{Object.keys(n).forEach(i=>{let l=n[i];typeof l=="number"&&(t[i.toUpperCase()]=l)})}),t},"processFn"),e,"VAT_RATES")}o(k,"fetchVatRates");A.exports={fetchVatRates:k}});var h=u((X,E)=>{function M(e,a){let s=Object.keys(e||{}).find(r=>r.toLowerCase()===a.toLowerCase());return s?e[s]?.toString().toUpperCase():null}o(M,"getHeaderValue");E.exports={getHeaderValue:M}});var p=u((Z,f)=>{function m(e){return e?e.toUpperCase():null}o(m,"getVatCountryCode");function N(e,a){let s=e*(1+a);return Math.round(s*100)/100}o(N,"calculatePriceWithVat");f.exports={getVatCountryCode:m,calculatePriceWithVat:N}});var v=u((x,V)=>{var{fetchVatRates:U}=T(),{getHeaderValue:W}=h(),{getVatCountryCode:$,calculatePriceWithVat:b}=p(),{policyMarketHeader:D}=_();async function d(e){if(e._vatRate!==void 0)return e._vatRate;let a=await U(e),s=W(e.headers,D),r=$(s),t=r&&a[r]?a[r]:0;return e._vatRate=t,t}o(d,"getVatRateForRequest");V.exports={resolvers:{Mutation:{clearCache:{resolve:o(async(e,a,s)=>{let{key:r}=a;try{return r?(await s.state.delete(r),s.logger.log("CACHE_CLEARED",{key:r}),!0):(await s.state.delete("VAT_RATES"),s.logger.log("ALL_CACHE_CLEARED"),!0)}catch(t){return s.logger.error("CACHE_CLEAR_ERROR",{error:t.message,key:r}),!1}},"resolve")}},ProductViewMoney:{value_with_vat:{selectionSet:"{ value }",resolve:o(async(e,a,s)=>{try{let r=await d(s),t=e.value||0,n=b(t,r);return s.logger.log("VAT_CALCULATION",{baseValue:t,vatRate:r,valueWithVat:n}),n}catch(r){return s.logger.error("VAT_CALCULATION_ERROR",{error:r.message}),e.value||0}},"resolve")},vat_rate:{resolve:o(async(e,a,s)=>{try{return await d(s)}catch(r){return s.logger.error("VAT_RATE_LOOKUP_ERROR",{error:r.message}),0}},"resolve")}}}}});var j=v();module.exports=j;
